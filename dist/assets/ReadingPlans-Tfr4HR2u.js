import{f as R,r as c,c as S,u as P,j as e,t as s,R as T,B as A}from"./index-Bk6rtcjo.js";import{G as I,T as k}from"./index-XruELgxz.js";import{g as L,c as O}from"./readingPlans-T_AOyLCJ.js";const W=T.memo(({onGenerate:a,onBack:h,isGenerating:l})=>{const{language:n}=P(),[r,g]=c.useState({version:"Evangélica",time:"30 minutos",frequency:"5 dias/semana",goal:"",preference:"Mista"}),t=x=>g(i=>({...i,[x.target.name]:x.target.value})),j=x=>{x.preventDefault(),a(r)};return e.jsxs("div",{className:"card",children:[e.jsx(A,{onClick:h,text:s.back[n]}),e.jsx("h2",{children:s.plan_generator_title[n]}),e.jsx("p",{children:s.plan_generator_desc[n]}),e.jsxs("form",{onSubmit:j,className:"plan-generator-form",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:s.plan_generator_version_label[n]}),e.jsxs("select",{name:"version",value:r.version,onChange:t,children:[e.jsx("option",{children:s.plan_generator_version_option_evangelical[n]}),e.jsx("option",{children:s.plan_generator_version_option_catholic[n]})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:s.plan_generator_time_label[n]}),e.jsxs("select",{name:"time",value:r.time,onChange:t,children:[e.jsx("option",{children:s.plan_generator_time_option_15[n]}),e.jsx("option",{children:s.plan_generator_time_option_30[n]}),e.jsx("option",{children:s.plan_generator_time_option_45[n]}),e.jsx("option",{children:s.plan_generator_time_option_60[n]})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:s.plan_generator_frequency_label[n]}),e.jsxs("select",{name:"frequency",value:r.frequency,onChange:t,children:[e.jsx("option",{children:s.plan_generator_frequency_option_5[n]}),e.jsx("option",{children:s.plan_generator_frequency_option_7[n]})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:s.plan_generator_goal_label[n]}),e.jsx("textarea",{name:"goal",rows:3,value:r.goal,onChange:t,placeholder:s.plan_generator_goal_placeholder[n]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:s.plan_generator_preference_label[n]}),e.jsxs("select",{name:"preference",value:r.preference,onChange:t,children:[e.jsx("option",{value:"Linear",children:s.plan_generator_preference_option_linear[n]}),e.jsx("option",{value:"Temática",children:s.plan_generator_preference_option_thematic[n]}),e.jsx("option",{value:"Mista",children:s.plan_generator_preference_option_mixed[n]})]})]}),e.jsx("div",{className:"form-actions",children:e.jsx("button",{type:"submit",className:"action-button",disabled:l,children:l?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"spinner"}),e.jsx("span",{children:s.plan_generator_generating_button[n]})]}):s.plan_generator_submit_button[n]})})]})]})}),J=T.memo(({planData:a,onBack:h,onAddPlan:l})=>{const{language:n}=P(),{showToast:r}=S(),g=()=>{l({id:a.id,title:a.title,description:s.plan_desc_custom_ai[n]}),r(s.generated_plan_added_toast[n]),h()};return e.jsxs("div",{className:"card generated-plan-view",children:[e.jsx(A,{onClick:h,text:s.back[n]}),e.jsx("h2",{children:a.title}),a.content,e.jsx("div",{className:"form-actions",children:e.jsxs("button",{className:"action-button",onClick:g,children:[e.jsx("i",{className:"material-icons",children:"add_circle_outline"})," ",s.add_plan[n]]})})]})}),z=T.memo(({itemId:a,itemText:h,planId:l,isChecked:n,note:r,index:g,updateProgress:t,updateNoteForPlanItem:j})=>{const{showToast:x}=S(),{language:i}=P(),[b,N]=c.useState(!1),[f,p]=c.useState(r||"");c.useEffect(()=>{p(r||"")},[r]);const o=c.useCallback(u=>{t(l,a,u.target.checked)},[t,l,a]),w=c.useCallback(()=>{N(u=>!u)},[]),_=c.useCallback(()=>{N(!1),p(r||"")},[r]),m=c.useCallback(()=>{j(l,a,f),x(s.note_saved_toast[i]),N(!1)},[f,l,a,x,j,i]);return e.jsxs("li",{className:"checklist-item-wrapper",children:[e.jsxs("div",{className:"checklist-item",children:[e.jsxs("label",{htmlFor:`${l}-${a}`,children:[e.jsx("input",{type:"checkbox",id:`${l}-${a}`,checked:n,onChange:o}),e.jsxs("span",{className:"item-text",children:[e.jsxs("span",{className:"item-text--number",children:[g+1,"."]})," ",h]})]}),e.jsx("button",{className:"add-note-for-item-btn",onClick:w,"aria-label":s.add_note_for_aria[i].replace("{item}",h),children:e.jsx("i",{className:"material-icons",children:r?"edit_note":"note_add"})})]}),r&&!b&&e.jsx("div",{className:"quick-note-display",children:r}),b&&e.jsxs("div",{className:"quick-note-editor",children:[e.jsx("textarea",{value:f,onChange:u=>p(u.target.value),placeholder:s.notes_quick_note_placeholder[i],rows:3,autoFocus:!0}),e.jsxs("div",{className:"quick-note-editor-actions",children:[e.jsx("button",{className:"quick-note-save-btn",onClick:m,children:s.save[i]}),e.jsx("button",{className:"quick-note-cancel-btn",onClick:_,children:s.cancel[i]})]})]})]})}),Y=T.memo(({plan:a})=>{const{removePlan:h,initiateNoteCreation:l,updateProgress:n,updateNoteForPlanItem:r}=R(),{language:g}=P(),t=c.useMemo(()=>O(a,g),[a,g]),[j,x]=c.useState(!1),i=c.useMemo(()=>{if(!t)return 0;const p=Object.values(a.progress||{}).filter(Boolean).length;let o=0;return t.type==="book-based"&&t.flatChecklist?o=t.flatChecklist.length:t.checklist&&(o=t.checklist.length),o>0?Math.round(p/o*100):0},[a.progress,t]),b=c.useCallback(()=>x(p=>!p),[]),N=c.useCallback(p=>{p.stopPropagation(),h(a.id)},[h,a.id]),f=()=>{if(!t)return e.jsx("p",{style:{padding:"1rem 0"},children:a.description});const p=(m,u)=>{var d;return e.jsx(z,{itemId:m.id,itemText:m.text,planId:a.id,isChecked:!!a.progress[m.id],note:(d=a.notes)==null?void 0:d[m.id],index:u,updateProgress:n,updateNoteForPlanItem:r},m.id)},o=(m,u)=>e.jsx("div",{className:"plan-checklist-container",children:u?Object.entries(m.reduce((d,v)=>{const y=v.category||"Outros";return d[y]||(d[y]=[]),d[y].push(v),d},{})).map(([d,v])=>e.jsxs("div",{className:"checklist-category-section",children:[e.jsx("h4",{className:"checklist-category-header",children:d}),e.jsx("ul",{className:"plan-checklist",children:v.map(p)})]},d)):e.jsx("ul",{className:"plan-checklist",children:m.map(p)})}),w=m=>{let u=0;return e.jsx("div",{className:"plan-checklist-container",children:m.map(d=>e.jsxs("div",{className:"testament-section",children:[e.jsxs("h4",{className:"checklist-testament-header",children:[d.emoji," ",d.testament]}),e.jsx("ul",{className:"plan-checklist",children:d.items.map(v=>{const y=p(v,u);return u++,y})})]},d.testament))})};let _;switch(t.type){case"book-based":_=w(t.checklist);break;case"thematic":_=o(t.checklist,!1);break;case"categorized":_=o(t.checklist,!0);break;case"simple":_=o(t.checklist,!1);break;default:return e.jsx("p",{style:{padding:"1rem 0"},children:a.description})}return e.jsxs("div",{className:"plan-progress-container",children:[e.jsxs("div",{className:"progress-bar-info",children:[e.jsx("span",{className:"progress-bar-label",children:s.my_plan_progress[g]}),e.jsxs("span",{className:"progress-percentage",children:[i,"%"]})]}),e.jsx("div",{className:"progress-bar-bg",children:e.jsx("div",{className:"progress-bar-fill",style:{width:`${i}%`}})}),_]})};return e.jsxs("div",{className:`my-plan-card ${j?"expanded":""}`,children:[e.jsxs("button",{className:"my-plan-card__header",onClick:b,"aria-expanded":j,children:[e.jsx("h3",{children:a.title}),e.jsxs("div",{className:"my-plan-card__header-actions",children:[e.jsx("button",{className:"my-plan-card__remove-btn",onClick:N,"aria-label":s.remove_plan_aria[g],children:e.jsx("i",{className:"material-icons",children:"close"})}),e.jsx("span",{className:"my-plan-card__expand-icon","aria-hidden":"true",children:e.jsx("i",{className:"material-icons",children:"expand_more"})})]})]}),e.jsxs("div",{className:"my-plan-card__content-wrapper",children:[j&&f(),e.jsx("div",{className:"plan-actions",children:e.jsxs("button",{className:"add-note-to-plan-btn",onClick:()=>l({planTitle:a.title}),children:[e.jsx("i",{className:"material-icons",children:"edit_note"}),e.jsx("span",{children:s.notes_new[g]})]})})]})]})}),V=T.memo(({plan:a,onAdd:h})=>{const{language:l}=P();return e.jsxs("div",{className:"plan-item",children:[e.jsxs("div",{className:"plan-item-content",children:[e.jsx("h3",{children:a.title}),e.jsx("p",{className:"plan-item-description",children:a.description}),e.jsxs("div",{className:"plan-item-details",children:[e.jsxs("div",{className:"plan-item-audience",children:[e.jsx("i",{className:"material-icons",children:"person"}),e.jsxs("div",{children:[e.jsx("strong",{children:s.plan_audience[l]}),e.jsx("span",{children:a.audience})]})]}),e.jsxs("div",{className:"plan-item-benefit",children:[e.jsx("i",{className:"material-icons",children:"star"}),e.jsxs("div",{children:[e.jsx("strong",{children:s.plan_benefit[l]}),e.jsx("span",{children:a.benefit})]})]})]})]}),e.jsx("button",{className:"add-plan-btn",onClick:()=>h(a),"aria-label":s.add_plan_for_aria[l].replace("{title}",a.title),children:e.jsx("i",{className:"material-icons",children:"add"})})]})}),Q=()=>{const{myPlans:a,addPlan:h}=R(),[l,n]=c.useState("list"),[r,g]=c.useState(null),[t,j]=c.useState(!1),{showToast:x}=S(),{language:i}=P(),b=c.useMemo(()=>new I({apiKey:void 0}),[]),N=c.useMemo(()=>L(i),[i]),f=c.useCallback(()=>n("list"),[]),p=c.useCallback(async o=>{j(!0);const{version:w,time:_,frequency:m,goal:u,preference:d}=o,G=`You are a wise and empathetic Bible study assistant. Your goal is to create personalized, encouraging, and practical Bible reading plans. The response MUST be a valid JSON object that adheres to the provided schema. The response language must be ${{pt:"português do Brasil",en:"American English",es:"Español"}[i]||"português do Brasil"}.`,q=`Create a personalized Bible reading plan based on the following user preferences:
- Preferred Bible version: ${w}
- Daily time available: ${_}
- Weekly reading frequency: ${m}
- Goal or current life situation: "${u||"Not specified, create a general plan for deepening faith."}"
- Reading style preference: ${d}`,$={type:k.OBJECT,properties:{diagnosis:{type:k.STRING,description:"Empathetic analysis of the user's situation in 1-2 sentences."},priorityBook:{type:k.STRING,description:"The main book or section of the Bible to read."},structure:{type:k.STRING,description:"How the user should structure their reading based on the time available."},firstWeekReadings:{type:k.ARRAY,items:{type:k.STRING},description:"A list of specific readings (book and chapters) for the first week."},finalAdvice:{type:k.STRING,description:"A final piece of advice or an encouraging thought."}},required:["diagnosis","priorityBook","structure","firstWeekReadings","finalAdvice"]};try{const E=(await b.models.generateContent({model:"gemini-2.5-flash",contents:q,config:{systemInstruction:G,responseMimeType:"application/json",responseSchema:$}})).text.trim();if(!E)throw new Error("Empty response from AI.");const C=JSON.parse(E),M=e.jsxs(e.Fragment,{children:[e.jsx("h3",{children:"Diagnóstico:"}),e.jsx("p",{children:C.diagnosis}),e.jsx("h3",{children:"Sugestão de Leitura:"}),e.jsxs("ul",{children:[e.jsxs("li",{children:[e.jsx("strong",{children:"Prioridade:"})," ",C.priorityBook]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Estrutura do Plano:"})," ",C.structure]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Primeiras Leituras (Semana 1):"}),e.jsx("ul",{children:Array.isArray(C.firstWeekReadings)&&C.firstWeekReadings.map((D,F)=>e.jsx("li",{children:D},F))})]})]}),e.jsx("h3",{children:"Conselho Final:"}),e.jsx("p",{children:C.finalAdvice})]});g({id:`custom-ai-${Date.now()}`,title:s.generated_plan_title[i],content:M}),n("generated")}catch(B){console.error("Erro ao gerar plano com IA:",B),x(s.error_generic[i])}finally{j(!1)}},[b,x,i]);return l==="form"?e.jsx(W,{onGenerate:p,onBack:f,isGenerating:t}):l==="generated"&&r?e.jsx(J,{planData:r,onBack:f,onAddPlan:h}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"my-plans-section",children:[e.jsx("h3",{className:"section-title",children:s.plans_my_progress[i]}),a.length===0?e.jsxs("div",{className:"my-plans-empty-state",children:[e.jsx("i",{className:"material-icons",children:"dashboard"}),e.jsx("p",{children:s.plans_empty_state[i]})]}):e.jsx("div",{className:"my-plans-list",children:a.map(o=>e.jsx(Y,{plan:o},o.id))})]}),e.jsxs("div",{className:"card",children:[e.jsx("h2",{children:s.plans_suggested[i]}),e.jsx("p",{children:s.plans_suggested_desc[i]}),e.jsxs("button",{className:"create-plan-btn",onClick:()=>n("form"),children:[e.jsx("i",{className:"material-icons",children:"auto_awesome"}),e.jsx("span",{children:s.plans_create_ai[i]})]}),e.jsx("div",{className:"plan-list",children:N.map(o=>e.jsx(V,{plan:o,onAdd:h},o.id))})]})]})};export{Q as default};
