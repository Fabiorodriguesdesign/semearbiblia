import{f as S,r as o,e as w,u as C,j as e,t as s,R as P,B as E}from"./index-bFsWClXM.js";import{g as q,a as T}from"./readingPlans-CgAFVali.js";const B=P.memo(({onGenerate:a,onBack:d,isGenerating:c})=>{const{language:n}=C(),[r,j]=o.useState({version:"Evangélica",time:"30 minutos",frequency:"5 dias/semana",goal:"",preference:"Mista"}),t=u=>j(l=>({...l,[u.target.name]:u.target.value})),g=u=>{u.preventDefault(),a(r)};return e.jsxs("div",{className:"card",children:[e.jsx(E,{onClick:d,text:s.back[n]}),e.jsx("h2",{children:s.plan_generator_title[n]}),e.jsx("p",{children:s.plan_generator_desc[n]}),e.jsxs("form",{onSubmit:g,className:"plan-generator-form",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:s.plan_generator_version_label[n]}),e.jsxs("select",{name:"version",value:r.version,onChange:t,children:[e.jsx("option",{children:s.plan_generator_version_option_evangelical[n]}),e.jsx("option",{children:s.plan_generator_version_option_catholic[n]})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:s.plan_generator_time_label[n]}),e.jsxs("select",{name:"time",value:r.time,onChange:t,children:[e.jsx("option",{children:s.plan_generator_time_option_15[n]}),e.jsx("option",{children:s.plan_generator_time_option_30[n]}),e.jsx("option",{children:s.plan_generator_time_option_45[n]}),e.jsx("option",{children:s.plan_generator_time_option_60[n]})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:s.plan_generator_frequency_label[n]}),e.jsxs("select",{name:"frequency",value:r.frequency,onChange:t,children:[e.jsx("option",{children:s.plan_generator_frequency_option_5[n]}),e.jsx("option",{children:s.plan_generator_frequency_option_7[n]})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:s.plan_generator_goal_label[n]}),e.jsx("textarea",{name:"goal",rows:3,value:r.goal,onChange:t,placeholder:s.plan_generator_goal_placeholder[n]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:s.plan_generator_preference_label[n]}),e.jsxs("select",{name:"preference",value:r.preference,onChange:t,children:[e.jsx("option",{value:"Linear",children:s.plan_generator_preference_option_linear[n]}),e.jsx("option",{value:"Temática",children:s.plan_generator_preference_option_thematic[n]}),e.jsx("option",{value:"Mista",children:s.plan_generator_preference_option_mixed[n]})]})]}),e.jsx("div",{className:"form-actions",children:e.jsx("button",{type:"submit",className:"action-button",disabled:c,children:c?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"spinner"}),e.jsx("span",{children:s.plan_generator_generating_button[n]})]}):s.plan_generator_submit_button[n]})})]})]})}),D=P.memo(({planData:a,onBack:d,onAddPlan:c})=>{const{language:n}=C(),{showToast:r}=w(),j=()=>{c({id:a.id,title:a.title,description:s.plan_desc_custom_ai[n]}),r(s.generated_plan_added_toast[n]),d()};return e.jsxs("div",{className:"card generated-plan-view",children:[e.jsx(E,{onClick:d,text:s.back[n]}),e.jsx("h2",{children:a.title}),a.content,e.jsx("div",{className:"form-actions",children:e.jsxs("button",{className:"action-button",onClick:j,children:[e.jsx("i",{className:"material-icons",children:"add_circle_outline"})," ",s.add_plan[n]]})})]})}),F=P.memo(({itemId:a,itemText:d,planId:c,isChecked:n,note:r,index:j,updateProgress:t,updateNoteForPlanItem:g})=>{const{showToast:u}=w(),{language:l}=C(),[k,b]=o.useState(!1),[v,i]=o.useState(r||"");o.useEffect(()=>{i(r||"")},[r]);const h=o.useCallback(x=>{t(c,a,x.target.checked)},[t,c,a]),_=o.useCallback(()=>{b(x=>!x)},[]),N=o.useCallback(()=>{b(!1),i(r||"")},[r]),p=o.useCallback(()=>{g(c,a,v),u(s.note_saved_toast[l]),b(!1)},[v,c,a,u,g,l]);return e.jsxs("li",{className:"checklist-item-wrapper",children:[e.jsxs("div",{className:"checklist-item",children:[e.jsxs("label",{htmlFor:`${c}-${a}`,children:[e.jsx("input",{type:"checkbox",id:`${c}-${a}`,checked:n,onChange:h}),e.jsxs("span",{className:"item-text",children:[e.jsxs("span",{className:"item-text--number",children:[j+1,"."]})," ",d]})]}),e.jsx("button",{className:"add-note-for-item-btn",onClick:_,"aria-label":s.add_note_for_aria[l].replace("{item}",d),children:e.jsx("i",{className:"material-icons",children:r?"edit_note":"note_add"})})]}),r&&!k&&e.jsx("div",{className:"quick-note-display",children:r}),k&&e.jsxs("div",{className:"quick-note-editor",children:[e.jsx("textarea",{value:v,onChange:x=>i(x.target.value),placeholder:s.notes_quick_note_placeholder[l],rows:3,autoFocus:!0}),e.jsxs("div",{className:"quick-note-editor-actions",children:[e.jsx("button",{className:"quick-note-save-btn",onClick:p,children:s.save[l]}),e.jsx("button",{className:"quick-note-cancel-btn",onClick:N,children:s.cancel[l]})]})]})]})}),R=P.memo(({plan:a})=>{const{removePlan:d,initiateNoteCreation:c,updateProgress:n,updateNoteForPlanItem:r}=S(),{language:j}=C(),t=o.useMemo(()=>T(a,j),[a,j]),[g,u]=o.useState(!1),l=o.useMemo(()=>{if(!t)return 0;const i=Object.values(a.progress||{}).filter(Boolean).length;let h=0;return t.type==="book-based"&&t.flatChecklist?h=t.flatChecklist.length:t.checklist&&(h=t.checklist.length),h>0?Math.round(i/h*100):0},[a.progress,t]),k=o.useCallback(()=>u(i=>!i),[]),b=o.useCallback(i=>{i.stopPropagation(),d(a.id)},[d,a.id]),v=()=>{if(!t)return e.jsx("p",{style:{padding:"1rem 0"},children:a.description});const i=(p,x)=>{var m;return e.jsx(F,{itemId:p.id,itemText:p.text,planId:a.id,isChecked:!!a.progress[p.id],note:(m=a.notes)==null?void 0:m[p.id],index:x,updateProgress:n,updateNoteForPlanItem:r},p.id)},h=(p,x)=>e.jsx("div",{className:"plan-checklist-container",children:x?Object.entries(p.reduce((m,f)=>{const y=f.category||"Outros";return m[y]||(m[y]=[]),m[y].push(f),m},{})).map(([m,f])=>e.jsxs("div",{className:"checklist-category-section",children:[e.jsx("h4",{className:"checklist-category-header",children:m}),e.jsx("ul",{className:"plan-checklist",children:f.map(i)})]},m)):e.jsx("ul",{className:"plan-checklist",children:p.map(i)})}),_=p=>{let x=0;return e.jsx("div",{className:"plan-checklist-container",children:p.map(m=>e.jsxs("div",{className:"testament-section",children:[e.jsxs("h4",{className:"checklist-testament-header",children:[m.emoji," ",m.testament]}),e.jsx("ul",{className:"plan-checklist",children:m.items.map(f=>{const y=i(f,x);return x++,y})})]},m.testament))})};let N;switch(t.type){case"book-based":N=_(t.checklist);break;case"thematic":N=h(t.checklist,!1);break;case"categorized":N=h(t.checklist,!0);break;case"simple":N=h(t.checklist,!1);break;default:return e.jsx("p",{style:{padding:"1rem 0"},children:a.description})}return e.jsxs("div",{className:"plan-progress-container",children:[e.jsxs("div",{className:"progress-bar-info",children:[e.jsx("span",{className:"progress-bar-label",children:s.my_plan_progress[j]}),e.jsxs("span",{className:"progress-percentage",children:[l,"%"]})]}),e.jsx("div",{className:"progress-bar-bg",children:e.jsx("div",{className:"progress-bar-fill",style:{width:`${l}%`}})}),N]})};return e.jsxs("div",{className:`my-plan-card ${g?"expanded":""}`,children:[e.jsxs("button",{className:"my-plan-card__header",onClick:k,"aria-expanded":g,children:[e.jsx("h3",{children:a.title}),e.jsxs("div",{className:"my-plan-card__header-actions",children:[e.jsx("button",{className:"my-plan-card__remove-btn",onClick:b,"aria-label":s.remove_plan_aria[j],children:e.jsx("i",{className:"material-icons",children:"close"})}),e.jsx("span",{className:"my-plan-card__expand-icon","aria-hidden":"true",children:e.jsx("i",{className:"material-icons",children:"expand_more"})})]})]}),e.jsxs("div",{className:"my-plan-card__content-wrapper",children:[g&&v(),e.jsx("div",{className:"plan-actions",children:e.jsxs("button",{className:"add-note-to-plan-btn",onClick:()=>c({planTitle:a.title}),children:[e.jsx("i",{className:"material-icons",children:"edit_note"}),e.jsx("span",{children:s.notes_new[j]})]})})]})]})}),A=P.memo(({plan:a,onAdd:d})=>{const{language:c}=C();return e.jsxs("div",{className:"plan-item",children:[e.jsxs("div",{className:"plan-item-content",children:[e.jsx("h3",{children:a.title}),e.jsx("p",{className:"plan-item-description",children:a.description}),e.jsxs("div",{className:"plan-item-details",children:[e.jsxs("div",{className:"plan-item-audience",children:[e.jsx("i",{className:"material-icons",children:"person"}),e.jsxs("div",{children:[e.jsx("strong",{children:s.plan_audience[c]}),e.jsx("span",{children:a.audience})]})]}),e.jsxs("div",{className:"plan-item-benefit",children:[e.jsx("i",{className:"material-icons",children:"star"}),e.jsxs("div",{children:[e.jsx("strong",{children:s.plan_benefit[c]}),e.jsx("span",{children:a.benefit})]})]})]})]}),e.jsx("button",{className:"add-plan-btn",onClick:()=>d(a),"aria-label":s.add_plan_for_aria[c].replace("{title}",a.title),children:e.jsx("i",{className:"material-icons",children:"add"})})]})}),$=()=>{const{myPlans:a,addPlan:d}=S(),[c,n]=o.useState("list"),[r,j]=o.useState(null),[t,g]=o.useState(!1),{showToast:u}=w(),{language:l}=C(),k=o.useMemo(()=>q(l),[l]),b=o.useCallback(()=>n("list"),[]),v=o.useCallback(async i=>{g(!0);try{const h=await fetch("/api/generatePlan",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({...i,language:l})});if(!h.ok)throw new Error("Failed to generate plan");const _=await h.json(),N=e.jsxs(e.Fragment,{children:[e.jsx("h3",{children:"Diagnóstico:"}),e.jsx("p",{children:_.diagnosis}),e.jsx("h3",{children:"Sugestão de Leitura:"}),e.jsxs("ul",{children:[e.jsxs("li",{children:[e.jsx("strong",{children:"Prioridade:"})," ",_.priorityBook]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Estrutura do Plano:"})," ",_.structure]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Primeiras Leituras (Semana 1):"}),e.jsx("ul",{children:Array.isArray(_.firstWeekReadings)&&_.firstWeekReadings.map((p,x)=>e.jsx("li",{children:p},x))})]})]}),e.jsx("h3",{children:"Conselho Final:"}),e.jsx("p",{children:_.finalAdvice})]});j({id:`custom-ai-${Date.now()}`,title:s.generated_plan_title[l],content:N}),n("generated")}catch(h){console.error("Erro ao gerar plano com IA:",h),u(s.error_generic[l])}finally{g(!1)}},[u,l]);return c==="form"?e.jsx(B,{onGenerate:v,onBack:b,isGenerating:t}):c==="generated"&&r?e.jsx(D,{planData:r,onBack:b,onAddPlan:d}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"my-plans-section",children:[e.jsx("h3",{className:"section-title",children:s.plans_my_progress[l]}),a.length===0?e.jsxs("div",{className:"my-plans-empty-state",children:[e.jsx("i",{className:"material-icons",children:"dashboard"}),e.jsx("p",{children:s.plans_empty_state[l]})]}):e.jsx("div",{className:"my-plans-list",children:a.map(i=>e.jsx(R,{plan:i},i.id))})]}),e.jsxs("div",{className:"card",children:[e.jsx("h2",{children:s.plans_suggested[l]}),e.jsx("p",{children:s.plans_suggested_desc[l]}),e.jsxs("button",{className:"create-plan-btn",onClick:()=>n("form"),children:[e.jsx("i",{className:"material-icons",children:"auto_awesome"}),e.jsx("span",{children:s.plans_create_ai[l]})]}),e.jsx("div",{className:"plan-list",children:k.map(i=>e.jsx(A,{plan:i,onAdd:d},i.id))})]})]})};export{$ as default};
